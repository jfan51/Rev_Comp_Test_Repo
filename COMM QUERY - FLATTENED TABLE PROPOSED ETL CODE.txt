DROP TABLE IF EXISTS CAL_TEMP_COMM;
-- THIS TABLE WILL STORE CALENDAR DATES FROM THE CAL_VW VIEW WHERE THE YTD_COMM_IND IS IN THE LIST  ('CY', 'PY', 'RY', 'PP')
CREATE LOCAL TEMPORARY TABLE CAL_TEMP_COMM ON COMMIT PRESERVE ROWS AS (
    SELECT CAL_DT 
    FROM PROD_USIG_CRCOG_DM_RPTG_VW.CAL_VW
    WHERE COMM_YR >=  (SELECT MAX(COMM_YR)-4 FROM PROD_USIG_CRCOG_DM_RPTG_VW.CAL_VW)
);

DROP TABLE IF EXISTS AGCY_AFFLTN_TEMP_COMM;

-- THIS TABLE WILL STORE AGENCY AFFILIATION DETAILS FROM THE AGCY_AFFLTN_VW VIEW WHERE THE DTRB_CHNL_CDE IS 'CAS'
CREATE LOCAL TEMPORARY TABLE AGCY_AFFLTN_TEMP_COMM ON COMMIT PRESERVE ROWS AS (
    SELECT AGCY_AFFLTN_ID, AGCY_ID, AGCY_NR, AGCY_NM,FLD_MGMT_TERR_NM
    FROM PROD_USIG_CRCOG_DM_RPTG_VW.AGCY_AFFLTN_VW
    WHERE DTRB_CHNL_CDE = 'CAS'
);

DROP TABLE IF EXISTS COMP_REV_COMM_FACT_TEMP;

CREATE LOCAL TEMPORARY TABLE COMP_REV_COMM_FACT_TEMP ON COMMIT PRESERVE ROWS AS (
    SELECT  UNIT_NR,
            PROD_SID,
            SEC_DT,
            AGMT_SID,
            CUST_FULL_NM,
            CYCLE_DT,
            AGCY_AFFLTN_ID,
            ADVSR_SPLIT_PCT,
            ADVSR_SID,
            AGCY_ID,
            AGCY_NR,
            AGCY_NM,
            FLD_MGMT_TERR_NM,
            BP_ID,
            ADVSR_FULL_NM,
            CRIA_IND,
            ORIG_FULL_TM_STRT_DT,
            REP_TYPE_DESC,
            YR_OF_SVC,
            HLDG_KEY,
            LOB_CDE,
            LOB_CDE_SORT,
            PROD_CTGY,
            PROD_SPON_NM,
            COMP_REV_PROD_TYP,
            SLS_RPTG_MAJOR_GRP_CDE,
	        SLS_RPTG_MAJOR_CTGY_CDE, 
	        SLS_RPTG_PROD_TYP_CDE,
	        SLS_RPTG_PROD_TYP_NM,
            UNIT_MGR_NM,
            UNIT_MGR_BPID,
            ADVSR_CLS_DESC,
            SUM(COMP_BSIS_AMT) AS COMP_BSIS_AMT,
            SUM(COMM_AMT_FYC) AS COMM_AMT_FYC,
            SUM(COMM_AMT_REN) AS COMM_AMT_REN,
            SUM(T1LADL) AS T1LADL,
            SUM(DI) AS DI,
            SUM(LTC) AS LTC,
            SUM(EB) AS EB,
            SUM(MMLIA) AS MMLIA,
            SUM(OTHER) AS OTHER,
            SUM(SPLRLIFEEXCESS) AS SPLRLIFEEXCESS,
            SUM(T1ANN) AS T1ANN,
            SUM(T1LIFEBASIC) AS T1LIFEBASIC,
            SUM(T1WSWL) AS T1WSWL,
            SUM(T2ANN) AS T2ANN,
            SUM(WS) AS WS,
            SUM(T1LADLRYC) AS T1LADLRYC,
            SUM(DIRYC) AS DIRYC,
            SUM(LTCRYC) AS LTCRYC,
            SUM(EBRYC) AS EBRYC,
            SUM(MMLIARYC) AS MMLIARYC,
            SUM(OTHERRYC) AS OTHERRYC,
            SUM(SPLRLIFEEXCESSRYC) AS SPLRLIFEEXCESSRYC,
            SUM(T1ANNRYC) AS T1ANNRYC,
            SUM(T1LIFEBASICRYC) AS T1LIFEBASICRYC,
            SUM(T1WSWLRYC) AS T1WSWLRYC,
            SUM(T2ANNRYC) AS T2ANNRYC,
            SUM(WSRYC) AS WSRYC,
    FROM (
        SELECT
        CF.UNIT_NR,
        CF.PROD_SID,
        SEC_DT,
        CF.AGMT_SID,
        CASE 
            WHEN TRIM(UPPER(CUSTOMER.FULL_NM)) = 'UNKWN' THEN ''
            ELSE COALESCE(TRIM(CUSTOMER.FULL_NM), '')
        END AS CUST_FULL_NM,
        CYCLE_DT,
        CF.AGCY_AFFLTN_ID,
        (CF.ADVSR_SPLT_PCT_FYC + CF.ADVSR_SPLT_PCT_REN) / 100 AS ADVSR_SPLIT_PCT,
        CF.ADVSR_SID,
        CASE 
            WHEN TX.COMP_SUB_TYP_CD IS NOT NULL AND UPPER(TX.COMP_SUB_TYP_CD) NOT IN ('TRAIL', ' ')
            THEN COALESCE(CF.COMP_BSIS_AMT, 0)
            ELSE 0
        END AS COMP_BSIS_AMT,
        COALESCE(CF.COMM_AMT_FYC, 0) AS COMM_AMT_FYC,
        COALESCE(CF.COMM_AMT_REN, 0) AS COMM_AMT_REN,
        A.AGCY_ID,
        A.AGCY_NR,
        A.AGCY_NM,
        A.FLD_MGMT_TERR_NM,
        ADVISOR.BP_ID,
        ADVISOR.FULL_NM AS ADVSR_FULL_NM,
        ADVISOR.CRIA_IND,
        ADVISOR.ORIG_FULL_TM_STRT_DT,
        ADVISOR.REP_TYPE_DESC,
        ADVISOR.YR_OF_SVC,
        TRIM(LEADING '0' FROM AGREEMENT.HLDG_KEY) AS HLDG_KEY,
        TRIM(PRODUCT.SLS_RPTG_LOB_CDE) AS LOB_CDE,
        CASE 
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'LIFE' THEN 3
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'ANN' THEN 4
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'DI' THEN 5
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'LTC' THEN 8
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'EB' THEN 7
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'WS' THEN 6
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIS' THEN 1
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIA' THEN 2
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'IMG' THEN 9
            ELSE 999
        END AS LOB_CDE_SORT,
        PRODUCT.SLS_RPTG_MAJOR_GRP_CDE,
	    PRODUCT.SLS_RPTG_MAJOR_CTGY_CDE, 
	    PRODUCT.SLS_RPTG_PROD_TYP_CDE,
	    PRODUCT.SLS_RPTG_PROD_TYP_NM,
        CASE 
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIA' THEN 'MMLIA'
            WHEN PRODUCT.MINOR_PROD_CDE IN ('32', '53', '66', '81') OR PRODUCT.MINOR_PROD_CDE = 'FINPLN' THEN 'MMLIS Advisory'
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIS' THEN 'MMLIS Non-Advisory'
            ELSE 'MM Proprietary'
        END AS PROD_CTGY,
        CASE 
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIS' AND PRODUCT.MINOR_PROD_CDE = '32' THEN 'WMS'
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIS' THEN PRODUCT.NONPROP_CARR_NM
            ELSE PRODUCT.SLS_RPTG_PROD_TYP_NM
        END AS PROD_SPON_NM,
        CASE 
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIS' AND PRODUCT.MINOR_PROD_CDE IN ('32','53','66') THEN 'CRIA'
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIS' AND PRODUCT.MINOR_PROD_CDE = '81' THEN 'MML Plan Solutions'
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIS' AND PRODUCT.MINOR_PROD_CDE IN ('51','76') THEN 'Mutual Fund Trails'
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIS' AND PRODUCT.MINOR_PROD_CDE IN ('78','80') THEN 'Non Prop Reg Group Other Trail'
            WHEN PRODUCT.SLS_RPTG_LOB_CDE = 'MMLIS' AND (PRODUCT.MINOR_PROD_CDE IN ('46','47','48','49') OR PRODUCT.MAJOR_PROD_NME = 'UNK') THEN PRODUCT.MINOR_PROD_NME
            ELSE PRODUCT.MAJOR_PROD_NME
        END AS COMP_REV_PROD_TYP,
        UNIT.UNIT_MGR_NM,
        UNIT.UNIT_MGR_BPID,
        COALESCE(NULLIF(ADVSR_CLS_DESC, 'UNKNOWN'), 'NA') AS ADVSR_CLS_DESC,
-- FYC
CASE WHEN ((TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('DI') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) or TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('LTC') or (CF.TIER_NR in ('01') and TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('ANN')) or (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('LIFE') and CF.TIER_NR in ('01') and PRODUCT.SLS_RPTG_MAJOR_GRP_CDE not in ('LIFE-ULE', 'LIFE-VLE')) or (PRODUCT.SLS_RPTG_MAJOR_CTGY_CDE in ('WS-WSWL') and CF.TIER_NR in ('01'))) THEN CF.COMM_AMT_FYC ELSE NULL END AS T1LADL,
CASE WHEN (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('DI') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_FYC ELSE NULL END AS DI,
CASE WHEN (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('LTC') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_FYC ELSE NULL END AS LTC,
CASE WHEN (TX.COMP_SUB_TYP_CD not in ('DIBRBON') and TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('EB')) THEN CF.COMM_AMT_FYC ELSE NULL END AS EB,
CASE WHEN (TX.COMP_SUB_TYP_CD not in ('DIBRBON') and TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('MMLIA')) THEN CF.COMM_AMT_FYC ELSE NULL END AS MMLIA,
CASE WHEN (TX.COMP_SUB_TYP_CD not in ('DIBRBON') and TRIM(PRODUCT.SLS_RPTG_LOB_CDE) not in ('ANN','DI','EB','LIFE','LTC','MMLIA','MMLIS','RS','UNKWN','WS','MET')) THEN CF.COMM_AMT_FYC ELSE NULL END AS OTHER,
CASE WHEN (TX.COMP_SUB_TYP_CD not in ('DIBRBON') and (PRODUCT.SLS_RPTG_MAJOR_GRP_CDE in ('LIFE-SPLR', 'LIFE-ULE', 'LIFE-VLE') or (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('LIFE') and CF.TIER_NR not in ('01')))) THEN CF.COMM_AMT_FYC ELSE NULL END AS SPLRLIFEEXCESS,
CASE WHEN (CF.TIER_NR in ('01') and TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('ANN') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_FYC ELSE NULL END AS T1ANN,
CASE WHEN (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('LIFE') and CF.TIER_NR in ('01') and PRODUCT.SLS_RPTG_MAJOR_GRP_CDE not in ('LIFE-ULE', 'LIFE-VLE') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_FYC ELSE NULL END AS T1LIFEBASIC,
CASE WHEN (PRODUCT.SLS_RPTG_MAJOR_CTGY_CDE in ('WS-WSWL') and CF.TIER_NR in ('01') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_FYC ELSE NULL END AS T1WSWL,
CASE WHEN (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('ANN') and CF.TIER_NR not in ('01') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_FYC ELSE NULL END AS T2ANN,
CASE WHEN (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('WS') and (not (PRODUCT.SLS_RPTG_MAJOR_CTGY_CDE in ('WS-WSWL') and CF.TIER_NR in ('01'))) and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_FYC ELSE NULL END AS WS,
--- RYC
CASE WHEN ((TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('DI') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) or TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('LTC') or (CF.TIER_NR in ('01') and TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('ANN')) or (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('LIFE') and CF.TIER_NR in ('01') and PRODUCT.SLS_RPTG_MAJOR_GRP_CDE not in ('LIFE-ULE', 'LIFE-VLE')) or (PRODUCT.SLS_RPTG_MAJOR_CTGY_CDE in ('WS-WSWL') and CF.TIER_NR in ('01'))) THEN CF.COMM_AMT_REN ELSE NULL END AS T1LADLRYC,
CASE WHEN (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('DI') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_REN ELSE NULL END AS DIRYC,
CASE WHEN (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('LTC') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_REN ELSE NULL END AS LTCRYC,
CASE WHEN (TX.COMP_SUB_TYP_CD not in ('DIBRBON') and TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('EB')) THEN CF.COMM_AMT_REN ELSE NULL END AS EBRYC,
CASE WHEN (TX.COMP_SUB_TYP_CD not in ('DIBRBON') and TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('MMLIA')) THEN CF.COMM_AMT_REN ELSE NULL END AS MMLIARYC,
CASE WHEN (TX.COMP_SUB_TYP_CD not in ('DIBRBON') and TRIM(PRODUCT.SLS_RPTG_LOB_CDE) not in ('ANN','DI','EB','LIFE','LTC','MMLIA','MMLIS','RS','UNKWN','WS','MET')) THEN CF.COMM_AMT_REN ELSE NULL END AS OTHERRYC,
CASE WHEN (TX.COMP_SUB_TYP_CD not in ('DIBRBON') and (PRODUCT.SLS_RPTG_MAJOR_GRP_CDE in ('LIFE-SPLR', 'LIFE-ULE', 'LIFE-VLE') or (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('LIFE') and CF.TIER_NR not in ('01')))) THEN CF.COMM_AMT_REN ELSE NULL END AS SPLRLIFEEXCESSRYC,
CASE WHEN (CF.TIER_NR in ('01') and TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('ANN') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_REN ELSE NULL END AS T1ANNRYC,
CASE WHEN (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('LIFE') and CF.TIER_NR in ('01') and PRODUCT.SLS_RPTG_MAJOR_GRP_CDE not in ('LIFE-ULE', 'LIFE-VLE') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_REN ELSE NULL END AS T1LIFEBASICRYC,
CASE WHEN (PRODUCT.SLS_RPTG_MAJOR_CTGY_CDE in ('WS-WSWL') and CF.TIER_NR in ('01') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_REN ELSE NULL END AS T1WSWLRYC,
CASE WHEN (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('ANN') and CF.TIER_NR not in ('01') and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_REN ELSE NULL END AS T2ANNRYC,
CASE WHEN (TRIM(PRODUCT.SLS_RPTG_LOB_CDE) in ('WS') and (not (PRODUCT.SLS_RPTG_MAJOR_CTGY_CDE in ('WS-WSWL') and CF.TIER_NR in ('01'))) and TX.COMP_SUB_TYP_CD not in ('DIBRBON')) THEN CF.COMM_AMT_REN ELSE NULL END AS WSRYC
    FROM PROD_USIG_CRCOG_DM_RPTG_VW.COMM_FACT_VW CF
    JOIN AGCY_AFFLTN_TEMP_COMM A ON CF.AGCY_AFFLTN_ID = A.AGCY_AFFLTN_ID
    LEFT JOIN PROD_USIG_CRCOG_DM_RPTG_VW.TXN_TYP_VW TX ON CF.COMM_TXN_TYP_SID = TX.TXN_TYP_SID
    LEFT JOIN PROD_USIG_CRCOG_DM_RPTG_VW.PROD_VW PRODUCT ON CF.PROD_SID = PRODUCT.PROD_SID
    LEFT JOIN PROD_USIG_CRCOG_DM_RPTG_VW.CUST_VW CUSTOMER ON CF.PRMY_OWNR_PRTY_ID = CUSTOMER.PRTY_ID
    LEFT JOIN PROD_USIG_CRCOG_DM_RPTG_VW.ADVSR_VW ADVISOR ON CF.ADVSR_SID = ADVISOR.ADVSR_SID
    LEFT JOIN PROD_USIG_CRCOG_DM_RPTG_VW.AGMT_VW AGREEMENT ON CF.AGMT_SID = AGREEMENT.AGMT_SID
    LEFT JOIN PROD_USIG_CRCOG_DM_RPTG_VW.UNT_VW UNIT ON CF.UNIT_MA_SID = UNIT.UNT_SID
    WHERE TRIM(PRODUCT.SLS_RPTG_LOB_CDE) NOT IN ('UNKWN', 'MMLIS', 'N/A', 'MET')
      AND UPPER(TX.COMP_SUB_TYP_CD) NOT IN ('DIBRBON')
      AND CF.CYCLE_DT IN (SELECT CAL_DT FROM CAL_TEMP_COMM)
    ) SUBQUERY
    GROUP BY  UNIT_NR,
              PROD_SID,
              SEC_DT,
              AGMT_SID,
              CUST_FULL_NM,
              CYCLE_DT,
              AGCY_AFFLTN_ID,
              ADVSR_SPLIT_PCT,
              ADVSR_SID,
              AGCY_ID,
              AGCY_NR,
              AGCY_NM,
              FLD_MGMT_TERR_NM,
              BP_ID,
              ADVSR_FULL_NM,
              CRIA_IND,
              ORIG_FULL_TM_STRT_DT,
              REP_TYPE_DESC,
              YR_OF_SVC,
              HLDG_KEY,
              LOB_CDE,
              LOB_CDE_SORT,
              PROD_CTGY,
              PROD_SPON_NM,
              COMP_REV_PROD_TYP,
              SLS_RPTG_MAJOR_GRP_CDE,
	          SLS_RPTG_MAJOR_CTGY_CDE, 
	          SLS_RPTG_PROD_TYP_CDE,
	          SLS_RPTG_PROD_TYP_NM,
              UNIT_MGR_NM,
              UNIT_MGR_BPID,
              ADVSR_CLS_DESC
);

TRUNCATE TABLE PROD_USIG_CRCOG_DM_WRK.WRK_COMP_REV_DTL_COMM;
--LOAD AGGREGATED DATA INTO WRK TABLE
INSERT INTO PROD_USIG_CRCOG_DM_WRK.WRK_COMP_REV_DTL_COMM
(
    ADVSR_SID,
    AGMT_SID,
    PROD_SID,
    AGCY_ID,
    AGCY_AFFLTN_ID,
    FLD_MGMT_TERR_NM,
    BP_ID,
    UNIT_MGR_BPID,
    AGCY_NR,
    UNIT_NR,
    AGCY_NM,
    UNIT_MGR_NM,
    CUST_FULL_NM,
    ADVSR_FULL_NM,
    CRIA_IND,
    ORIG_FULL_TM_STRT_DT,
    REP_TYPE_DESC,
    YR_OF_SVC,
    LOB_CDE,
    HLDG_KEY,
    LOB_CDE_SORT,
    SLS_RPTG_MAJOR_GRP_CDE,
	SLS_RPTG_MAJOR_CTGY_CDE, 
	SLS_RPTG_PROD_TYP_CDE,
	SLS_RPTG_PROD_TYP_NM,
    PROD_CTGY,
    PROD_SPON_NM,
    COMP_REV_PROD_TYP,
    CYCLE_DT,
    SEC_DT,
    COMM_AMT_FYC,
    COMM_AMT_REN,
    ADVSR_SPLIT_PCT,
    COMP_BSIS_AMT,
    T1LADL,
    DI,
    LTC,
    EB,
    MMLIA,
    OTHER,
    SPLRLIFEEXCESS,
    T1ANN,
    T1LIFEBASIC,
    T1WSWL,
    T2ANN,
    WS,
    T1LADLRYC,
    DIRYC,
    LTCRYC,
    EBRYC,
    MMLIARYC,
    OTHERRYC,
    SPLRLIFEEXCESSRYC,
    T1ANNRYC,
    T1LIFEBASICRYC,
    T1WSWLRYC,
    T2ANNRYC,
    WSRYC,
    FPAS_PAYOUT_AMT,
    GDC_AMOUNT,
    MMLIS_FYC_AMT,
    GDC_PAYOUT_AMT,
    INVD_AMT,
    ADVSRY_GDC_AMT,
    NON_ADVSRY_GDC_AMT,
    TOTAL_FYC_AMT,
    LST_MOD_TS,
    ADVSR_CLS_DESC
)
SELECT 
    ADVSR_SID,
    AGMT_SID,
    PROD_SID,
    AGCY_ID,
    AGCY_AFFLTN_ID,
    FLD_MGMT_TERR_NM,
    BP_ID,
    UNIT_MGR_BPID,
    AGCY_NR,
    UNIT_NR,
    AGCY_NM,
    UNIT_MGR_NM,
    CUST_FULL_NM,
    ADVSR_FULL_NM,
    CRIA_IND,
    ORIG_FULL_TM_STRT_DT,
    REP_TYPE_DESC,
    YR_OF_SVC,
    LOB_CDE,
    HLDG_KEY,
    LOB_CDE_SORT,
    SLS_RPTG_MAJOR_GRP_CDE,
	SLS_RPTG_MAJOR_CTGY_CDE, 
	SLS_RPTG_PROD_TYP_CDE,
	SLS_RPTG_PROD_TYP_NM,
    PROD_CTGY,
    PROD_SPON_NM,
    COMP_REV_PROD_TYP,
    CYCLE_DT,
    SEC_DT,
    COMM_AMT_FYC,
    COMM_AMT_REN,
    ADVSR_SPLIT_PCT,
    COMP_BSIS_AMT,
    T1LADL,
    DI,
    LTC,
    EB,
    MMLIA,
    OTHER,
    SPLRLIFEEXCESS,
    T1ANN,
    T1LIFEBASIC,
    T1WSWL,
    T2ANN,
    WS,
    T1LADLRYC,
    DIRYC,
    LTCRYC,
    EBRYC,
    MMLIARYC,
    OTHERRYC,
    SPLRLIFEEXCESSRYC,
    T1ANNRYC,
    T1LIFEBASICRYC,
    T1WSWLRYC,
    T2ANNRYC,
    WSRYC,
    0 AS FPAS_PAYOUT_AMT,
    0 AS GDC_AMOUNT,
    0 AS MMLIS_FYC_AMT,
    0 AS GDC_PAYOUT_AMT,
    0 AS INVD_AMT,
    0 AS ADVSRY_GDC_AMT,
    0 AS NON_ADVSRY_GDC_AMT,
    COMM_AMT_FYC AS TOTAL_FYC_AMT, -- sum of COMM_AMT_FYC and MMLIS_FYC_AMT
    CURRENT_TIMESTAMP AS LST_MOD_TS,
    ADVSR_CLS_DESC
FROM COMP_REV_COMM_FACT_TEMP
    where  COMM_AMT_FYC <>0 or COMM_AMT_REN<>0 or COMP_BSIS_AMT <>0  ;